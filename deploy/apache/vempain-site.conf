# Place this file under /etc/httpd/conf.d/ or /etc/apache2/sites-available/
# Replace <HOSTNAME> with your public domain (e.g. my.host.name)
Define virtual_host <HOSTNAME>

<VirtualHost *:80>
    ServerName ${virtual_host}
    # Redirect cleartext to HTTPS
    Redirect permanent / https://${virtual_host}/
</VirtualHost>

<VirtualHost *:443>
    ServerName ${virtual_host}

    <IfModule mod_headers.c>
         Header set Access-Control-Allow-Origin "https://${virtual_host}/"
    </IfModule>

    SSLEngine on
    SSLCertificateFile      /etc/letsencrypt/live/${virtual_host}/cert.pem
    SSLCertificateKeyFile   /etc/letsencrypt/live/${virtual_host}/privkey.pem
    SSLCertificateChainFile /etc/letsencrypt/live/${virtual_host}/fullchain.pem

    # Harden TLS configuration (adjust to local policy)
    SSLProtocol             all -SSLv3 -TLSv1 -TLSv1.1
    SSLCipherSuite          HIGH:!aNULL:!MD5
    SSLHonorCipherOrder     on

    Header          always set Strict-Transport-Security    "max-age=63072000; includeSubDomains; preload"
    Header          always set X-Content-Type-Options       nosniff
    Header          always set Cache-Control                "no-cache, no-store, must-revalidate, private Pragma: no-cache Expires: 0"
    Header          always set X-XSS-Protection             "1; mode=block"
    Header          always set Permissions-Policy           "geolocation=(),midi=(),sync-xhr=(),microphone=(),camera=(),magnetometer=(),gyroscope=(),fullscreen=(self),payment=()"

    SSLCompression          off

    # Proxy to Traefik running inside Docker listening on host port 6000
    ProxyPreserveHost On
    ProxyPassReverse / http://127.0.0.1:6000/
    ProxyPass        / http://127.0.0.1:6000/

    # Optional: allow large uploads
    LimitRequestBody 52428800

    TransferLog  /var/log/httpd/${virtual_host}/${virtual_host}-ssl_access.log
    ErrorLog     /var/log/httpd/${virtual_host}/${virtual_host}-ssl_error.log
</VirtualHost>

